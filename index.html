<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prime Factor Distribution Explorer | Interactive Number Theory</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Interactive visualization for exploring the finite-size distribution of Œ©(n) modulo m. Discover patterns in prime factor counts with real-time computation and analysis.">
    <meta name="keywords" content="number theory, omega function, prime factors, fourier analysis, mathematics, visualization">
    <meta name="author" content="Oksana Sudoma">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Prime Factor Distribution Explorer">
    <meta property="og:description" content="Explore how prime factors distribute across residue classes with interactive visualizations and real-time computation.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://boonespacedog.github.io/omega-mod-m/">
    <meta property="og:image" content="https://boonespacedog.github.io/omega-mod-m/figures/omega_decay_unified.png">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Prime Factor Distribution Explorer">
    <meta name="twitter:description" content="Explore prime factor distribution patterns with real-time interactive computations">
    <meta name="twitter:image" content="https://boonespacedog.github.io/omega-mod-m/figures/omega_decay_unified.png">
    
    <!-- Preconnect to external domains for faster loading -->
    <link rel="preconnect" href="https://cdn.plot.ly">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- External Libraries with defer for non-blocking load -->
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js" defer></script>
    
    <style>
        :root {
            --primary: #334155;
            --secondary: #64748b;
            --success: #48bb78;
            --info: #4299e1;
            --warning: #ed8936;
            --danger: #f56565;
            --dark: #2d3748;
            --light: #f7fafc;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            position: relative;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: fadeIn 0.3s ease-in;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .paper-link {
            display: inline-block;
            margin-top: 15px;
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .paper-link:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .main-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 20px;
            border: none;
            background: var(--light);
            color: var(--dark);
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .tab.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 5px 15px rgba(51, 65, 85, 0.4);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.2s ease-in;
        }

        .tab-content.active {
            display: block;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-card {
            background: var(--light);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .control-card h3 {
            margin-top: 0;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .slider-container {
            margin: 15px 0;
        }

        .slider-container label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--dark);
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }

        .slider-value {
            display: inline-block;
            margin-left: 10px;
            padding: 2px 8px;
            background: var(--primary);
            color: white;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-secondary {
            background: var(--info);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .function-btn {
            background: white;
            color: var(--dark);
            border: 2px solid var(--primary);
        }

        .function-btn.active {
            background: var(--primary);
            color: white;
        }

        .plot-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            min-height: 400px;
        }

        .plot-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h4 {
            margin: 0 0 5px 0;
            font-size: 0.9em;
            opacity: 0.9;
        }

        .stat-card .value {
            font-size: 1.8em;
            font-weight: bold;
        }

        .theory-box {
            background: linear-gradient(135deg, rgba(51, 65, 85, 0.1), rgba(100, 116, 139, 0.1));
            border-left: 4px solid var(--primary);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .theory-box h4 {
            margin-top: 0;
            color: var(--primary);
        }

        .formula {
            font-family: 'Courier New', monospace;
            background: rgba(255,255,255,0.5);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            overflow-x: auto;
        }

        .icon {
            font-size: 1.5em;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .github-link {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--dark);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .github-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Prime Factor Distribution Explorer</h1>
            <p>Explore how prime factors distribute across residue classes. Watch patterns emerge in real-time as you adjust parameters and test theoretical predictions with interactive computations.</p>
            <a href="paper/omega_mod3.pdf" class="paper-link" target="_blank">
                üìÑ Read the Paper ‚Üó
            </a>
        </div>

        <div class="main-panel">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('distribution')">Distribution Explorer</button>
                <button class="tab" onclick="switchTab('theory')">Theory & Analysis</button>
                <button class="tab" onclick="switchTab('fourier')">Fourier Framework</button>
                <button class="tab" onclick="switchTab('weighted')">Weighted Ensembles</button>
                <button class="tab" onclick="switchTab('comparison')">Function Comparison</button>
                <button class="tab" onclick="switchTab('tools')">Advanced Tools</button>
            </div>

            <!-- Distribution Explorer Tab -->
            <div class="tab-content active" id="distribution-tab">
                <div class="controls">
                    <div class="control-card">
                        <h3><span class="icon">üéØ</span> Function Selection</h3>
                        <div class="button-group">
                            <button class="function-btn active" onclick="selectFunction('omega')">Œ©(n)</button>
                            <button class="function-btn" onclick="selectFunction('littleOmega')">œâ(n)</button>
                            <button class="function-btn" onclick="selectFunction('tau')">œÑ(n)</button>
                            <button class="function-btn" onclick="selectFunction('sigma')">œÉ(n)</button>
                            <button class="function-btn" onclick="selectFunction('lambda')">Œª(n)</button>
                        </div>
                    </div>

                    <div class="control-card">
                        <h3><span class="icon">‚öôÔ∏è</span> Parameters</h3>
                        <div class="slider-container">
                            <label>Maximum n: <span class="slider-value" id="nValue">10000</span></label>
                            <input type="range" class="slider" id="nSlider" min="100" max="1000000" value="10000" step="100">
                        </div>
                        <div class="slider-container">
                            <label>Modulus m: <span class="slider-value" id="mValue">3</span></label>
                            <input type="range" class="slider" id="mSlider" min="2" max="10" value="3" step="1">
                        </div>
                        <div class="button-group">
                            <button class="btn-primary" onclick="computeDistribution()">
                                <span id="computeText">Compute Distribution</span>
                            </button>
                            <button class="btn-secondary" onclick="animateGrowth()">
                                <span id="animateText">Animate Growth</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="stats-grid" id="statsGrid">
                    <!-- Stats will be populated here -->
                </div>

                <div class="plot-container" id="distributionPlot"></div>
                <div class="plot-container" id="deviationPlot"></div>

                <div class="theory-box">
                    <h4>Theoretical Background</h4>
                    <p>The function Œ©(n) counts prime factors with multiplicity. For n = p‚ÇÅ^a‚ÇÅ √ó p‚ÇÇ^a‚ÇÇ √ó ... √ó p‚Çñ^a‚Çñ:</p>
                    <div class="formula">Œ©(n) = a‚ÇÅ + a‚ÇÇ + ... + a‚Çñ</div>
                    <p>Our research shows that the finite-size deviation from uniform distribution follows:</p>
                    <div class="formula">|S(x)|/x ~ C_m √ó (log x)^(cos(2œÄ/m) - 1)</div>
                </div>
            </div>

            <!-- Theory & Analysis Tab -->
            <div class="tab-content" id="theory-tab">
                <div class="controls">
                    <div class="control-card">
                        <h3><span class="icon">üìä</span> Decay Analysis</h3>
                        <button class="btn-primary" onclick="analyzeDecay()">Analyze Decay Law</button>
                        <button class="btn-secondary" onclick="estimateConstant()">Estimate C‚ÇÉ</button>
                    </div>
                </div>
                
                <div class="plot-container" id="theoryPlot"></div>
                
                <div class="theory-box">
                    <h4>Finite-Size Law</h4>
                    <p>For m = 3, the first Fourier coefficient decays as:</p>
                    <div class="formula">|S(x)|/x ~ 1.708 √ó (log x)^(-3/2)</div>
                    <p>This matches the Selberg-Delange/Hal√°sz prediction with cos(2œÄ/3) - 1 = -3/2.</p>
                    <p><strong>Note:</strong> The constant C‚ÇÉ = 1.708 is computed using natural logarithms (ln), not log‚ÇÅ‚ÇÄ.</p>
                </div>
            </div>

            <!-- Fourier Framework Tab -->
            <div class="tab-content" id="fourier-tab">
                <div class="controls">
                    <div class="control-card">
                        <h3><span class="icon">„Ä∞Ô∏è</span> Fourier Analysis</h3>
                        <button class="btn-primary" onclick="computeCharacterSums()">Compute S(x)</button>
                    </div>
                </div>
                
                <div class="plot-grid">
                    <div class="plot-container" id="fourierRealPlot"></div>
                    <div class="plot-container" id="fourierImagPlot"></div>
                </div>
                
                <div class="theory-box">
                    <h4>Fourier Decomposition</h4>
                    <p>All deviations from uniformity are captured by the single complex sum:</p>
                    <div class="formula">S(x) = Œ£_{n‚â§x} e^(2œÄi¬∑Œ©(n)/m)</div>
                </div>
            </div>

            <!-- Weighted Ensembles Tab -->
            <div class="tab-content" id="weighted-tab">
                <div class="controls">
                    <div class="control-card">
                        <h3><span class="icon">‚öñÔ∏è</span> Weighted Analysis</h3>
                        <div class="slider-container">
                            <label>Œ≤ parameter: <span class="slider-value" id="betaValue">1.5</span></label>
                            <input type="range" class="slider" id="betaSlider" min="0.1" max="3" value="1.5" step="0.1">
                        </div>
                        <button class="btn-primary" onclick="computeWeighted()">Compute Weighted</button>
                    </div>
                </div>
                
                <div class="plot-container" id="weightedPlot"></div>
            </div>

            <!-- Function Comparison Tab -->
            <div class="tab-content" id="comparison-tab">
                <div class="controls">
                    <div class="control-card">
                        <h3><span class="icon">üìà</span> Compare Functions</h3>
                        <div class="button-group">
                            <button class="btn-primary" onclick="compareAllFunctions()">Compare All</button>
                            <button class="btn-secondary" onclick="generateHeatmap()">Bias Heatmap</button>
                        </div>
                    </div>
                </div>
                
                <div class="plot-container" id="comparisonPlot"></div>
                <div class="plot-container" id="heatmapPlot"></div>
            </div>

            <!-- Advanced Tools Tab -->
            <div class="tab-content" id="tools-tab">
                <div class="controls">
                    <div class="control-card">
                        <h3><span class="icon">üîß</span> Tools</h3>
                        <div class="button-group">
                            <button class="btn-success" onclick="exportData()">Export Data</button>
                            <button class="btn-secondary" onclick="generateReport()">Generate Report</button>
                            <button class="btn-danger" onclick="resetAll()">Reset All</button>
                        </div>
                    </div>
                    <div class="control-card">
                        <h3><span class="icon">üßÆ</span> Calculator</h3>
                        <input type="number" id="calcInput" placeholder="Enter n" style="width: 100%; padding: 8px; margin: 10px 0;">
                        <button class="btn-primary" onclick="calculateSingle()">Calculate Œ©(n)</button>
                        <div id="calcResult" style="margin-top: 10px;"></div>
                    </div>
                </div>
                
                <div class="theory-box">
                    <h4>Export Formats</h4>
                    <ul>
                        <li>JSON: Complete data with metadata</li>
                        <li>CSV: Tabular format for analysis</li>
                        <li>LaTeX: Tables for papers</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <a href="https://github.com/boonespacedog/omega-mod-m" class="github-link" target="_blank">
        <svg height="20" width="20" viewBox="0 0 16 16" fill="currentColor">
            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
        </svg>
        View on GitHub
    </a>

    <footer style="background: var(--dark); color: white; padding: 40px 20px; margin-top: 60px; text-align: center; font-size: 0.9em;">
        <div style="max-width: 1200px; margin: 0 auto;">
            <p style="margin: 10px 0;">¬© 2025 Oksana Sudoma</p>
            <p style="margin: 10px 0;">
                Code: <a href="https://github.com/boonespacedog/omega-mod-m/blob/main/LICENSE" target="_blank" style="color: #64748b; text-decoration: none;">MIT License</a> |
                Paper: <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" style="color: #64748b; text-decoration: none;">CC BY 4.0</a>
            </p>
            <p style="margin: 15px 0;">
                <a href="https://github.com/boonespacedog" target="_blank" style="color: white; text-decoration: none; margin: 0 15px;">
                    <svg height="20" width="20" viewBox="0 0 16 16" fill="currentColor" style="vertical-align: middle; margin-right: 5px;">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                    </svg>
                    GitHub
                </a>
                <a href="https://www.linkedin.com/in/oksanasudoma/" target="_blank" style="color: white; text-decoration: none; margin: 0 15px;">
                    <svg height="20" width="20" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle; margin-right: 5px;">
                        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                    </svg>
                    LinkedIn
                </a>
            </p>
            <p style="margin: 15px 0; font-size: 0.85em; opacity: 0.8;">
                Interactive tool for "Finite-Size Equidistribution of Œ©(n) Modulo m"
            </p>
        </div>
    </footer>

    <script>
        // Global state
        let currentFunction = 'omega';
        let currentTab = 'distribution';
        let computedData = {};
        let animationRunning = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeSliders();
            initializePlots();
            updateUI();
        });

        // Initialize sliders
        function initializeSliders() {
            const nSlider = document.getElementById('nSlider');
            const mSlider = document.getElementById('mSlider');
            const betaSlider = document.getElementById('betaSlider');
            
            nSlider.oninput = function() {
                document.getElementById('nValue').textContent = this.value;
            };
            
            mSlider.oninput = function() {
                document.getElementById('mValue').textContent = this.value;
            };
            
            if (betaSlider) {
                betaSlider.oninput = function() {
                    document.getElementById('betaValue').textContent = this.value;
                };
            }
        }

        // Initialize empty plots
        function initializePlots() {
            const plotIds = ['distributionPlot', 'deviationPlot', 'theoryPlot', 
                           'fourierRealPlot', 'fourierImagPlot', 'weightedPlot', 
                           'comparisonPlot', 'heatmapPlot'];
            
            plotIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    Plotly.newPlot(element, [], {}, {responsive: true, staticPlot: true});
                }
            });
        }

        // Update UI
        function updateUI() {
            // Update any UI elements based on state
        }

        // Tab switching
        function switchTab(tabName) {
            // Remove active class from all tabs and contents
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Add active class to clicked tab and corresponding content
            event.target.classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            currentTab = tabName;
            
            // Initialize tab-specific content if needed
            if (tabName === 'theory' && !document.getElementById('theoryPlot').data) {
                plotTheoryComparison();
            }
        }

        // Function selection
        function selectFunction(func) {
            currentFunction = func;
            document.querySelectorAll('.function-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // Compute omega function
        function computeOmega(n) {
            let count = 0;
            let temp = n;
            for (let p = 2; p * p <= temp; p++) {
                while (temp % p === 0) {
                    count++;
                    temp = Math.floor(temp / p);
                }
            }
            if (temp > 1) count++;
            return count;
        }

        // Compute little omega (distinct prime factors)
        function computeLittleOmega(n) {
            let count = 0;
            let temp = n;
            for (let p = 2; p * p <= temp; p++) {
                if (temp % p === 0) {
                    count++;
                    while (temp % p === 0) {
                        temp = Math.floor(temp / p);
                    }
                }
            }
            if (temp > 1) count++;
            return count;
        }

        // Compute tau (number of divisors)
        function computeTau(n) {
            let count = 0;
            for (let i = 1; i * i <= n; i++) {
                if (n % i === 0) {
                    count++;
                    if (i * i !== n) count++;
                }
            }
            return count;
        }

        // Compute sigma (sum of divisors)
        function computeSigma(n) {
            let sum = 0;
            for (let i = 1; i * i <= n; i++) {
                if (n % i === 0) {
                    sum += i;
                    if (i * i !== n) sum += n / i;
                }
            }
            return sum;
        }

        // Compute Liouville lambda
        function computeLambda(n) {
            return Math.pow(-1, computeOmega(n));
        }

        // Get function value based on current selection
        function getFunctionValue(n) {
            switch(currentFunction) {
                case 'omega': return computeOmega(n);
                case 'littleOmega': return computeLittleOmega(n);
                case 'tau': return computeTau(n);
                case 'sigma': return computeSigma(n);
                case 'lambda': return computeLambda(n);
                default: return computeOmega(n);
            }
        }

        // Main computation function
        async function computeDistribution() {
            const maxN = parseInt(document.getElementById('nSlider').value);
            const mod = parseInt(document.getElementById('mSlider').value);
            
            // Show loading state
            document.getElementById('computeText').innerHTML = '<span class="loading"></span> Computing...';
            
            // Initialize counts
            const counts = new Array(mod).fill(0);
            const values = [];
            
            // Compute in chunks for better performance
            const chunkSize = 1000;
            for (let start = 1; start <= maxN; start += chunkSize) {
                const end = Math.min(start + chunkSize - 1, maxN);
                
                for (let n = start; n <= end; n++) {
                    const value = getFunctionValue(n);
                    const residue = ((value % mod) + mod) % mod;
                    counts[residue]++;
                    values.push({n: n, value: value, residue: residue});
                }
                
                // Allow UI to update
                if (start % 10000 === 1) {
                    await new Promise(resolve => setTimeout(resolve, 0));
                }
            }
            
            // Store computed data
            computedData = {
                maxN: maxN,
                mod: mod,
                counts: counts,
                values: values,
                function: currentFunction
            };
            
            // Update plots
            plotDistribution(counts, mod);
            plotDeviation(values, mod, maxN);
            updateStats(counts, maxN);
            
            // Reset button
            document.getElementById('computeText').textContent = 'Compute Distribution';
        }

        // Plot distribution
        function plotDistribution(counts, mod) {
            const trace = {
                x: Array.from({length: mod}, (_, i) => i),
                y: counts,
                type: 'bar',
                marker: {
                    color: 'rgba(51, 65, 85, 0.8)',
                    line: {
                        color: 'rgba(51, 65, 85, 1)',
                        width: 2
                    }
                }
            };
            
            const layout = {
                title: `Distribution of ${currentFunction}(n) mod ${mod}`,
                xaxis: {title: 'Residue Class'},
                yaxis: {title: 'Count'},
                showlegend: false
            };
            
            Plotly.newPlot('distributionPlot', [trace], layout, {responsive: true, staticPlot: true});
        }

        // Plot deviation from uniform
        function plotDeviation(values, mod, maxN) {
            const cumulative = {};
            for (let r = 0; r < mod; r++) {
                cumulative[r] = [];
            }
            
            const counts = new Array(mod).fill(0);
            values.forEach((v, i) => {
                counts[v.residue]++;
                if (i % 100 === 0) {  // Sample for performance
                    for (let r = 0; r < mod; r++) {
                        const expected = (i + 1) / mod;
                        const deviation = counts[r] - expected;
                        cumulative[r].push({x: v.n, y: deviation});
                    }
                }
            });
            
            const traces = Object.keys(cumulative).map(r => ({
                x: cumulative[r].map(p => p.x),
                y: cumulative[r].map(p => p.y),
                name: `Residue ${r}`,
                type: 'scatter',
                mode: 'lines'
            }));
            
            const layout = {
                title: 'Deviation from Uniform Distribution',
                xaxis: {title: 'n', type: 'log'},
                yaxis: {title: 'Count - Expected'},
                showlegend: true
            };
            
            Plotly.newPlot('deviationPlot', traces, layout, {responsive: true, staticPlot: true});
        }

        // Update statistics
        function updateStats(counts, maxN) {
            const total = counts.reduce((a, b) => a + b, 0);
            const expected = total / counts.length;
            const chiSquare = counts.reduce((sum, count) => {
                return sum + Math.pow(count - expected, 2) / expected;
            }, 0);
            
            const statsHTML = `
                <div class="stat-card">
                    <h4>Total Count</h4>
                    <div class="value">${total.toLocaleString()}</div>
                </div>
                <div class="stat-card">
                    <h4>Expected per Class</h4>
                    <div class="value">${expected.toFixed(0)}</div>
                </div>
                <div class="stat-card">
                    <h4>Chi-Square</h4>
                    <div class="value">${chiSquare.toFixed(2)}</div>
                </div>
                <div class="stat-card">
                    <h4>Max Deviation</h4>
                    <div class="value">${Math.max(...counts.map(c => Math.abs(c - expected))).toFixed(0)}</div>
                </div>
            `;
            
            document.getElementById('statsGrid').innerHTML = statsHTML;
        }

        // Animate growth
        async function animateGrowth() {
            if (animationRunning) return;
            animationRunning = true;
            
            document.getElementById('animateText').innerHTML = '<span class="loading"></span> Animating...';
            
            const maxN = parseInt(document.getElementById('nSlider').value);
            const mod = parseInt(document.getElementById('mSlider').value);
            const step = Math.max(100, Math.floor(maxN / 100));
            
            for (let n = step; n <= maxN; n += step) {
                const counts = new Array(mod).fill(0);
                
                for (let i = 1; i <= n; i++) {
                    const value = getFunctionValue(i);
                    const residue = ((value % mod) + mod) % mod;
                    counts[residue]++;
                }
                
                plotDistribution(counts, mod);
                await new Promise(resolve => setTimeout(resolve, 50));
                
                if (!animationRunning) break;
            }
            
            document.getElementById('animateText').textContent = 'Animate Growth';
            animationRunning = false;
        }

        // Plot theory comparison
        function plotTheoryComparison() {
            const x = [];
            const theoretical = [];
            const empirical = [];
            
            for (let i = 3; i <= 8; i++) {
                const n = Math.pow(10, i);
                x.push(n);
                theoretical.push(1.708 * Math.pow(Math.log(n), -1.5));
                empirical.push(1.708 * Math.pow(Math.log(n), -1.497));  // From paper
            }
            
            const trace1 = {
                x: x,
                y: theoretical,
                name: 'Theoretical',
                type: 'scatter',
                mode: 'lines+markers',
                line: {color: 'rgba(51, 65, 85, 1)', width: 3}
            };
            
            const trace2 = {
                x: x,
                y: empirical,
                name: 'Empirical Fit',
                type: 'scatter',
                mode: 'lines+markers',
                line: {color: 'rgba(234, 102, 126, 1)', width: 3, dash: 'dash'}
            };
            
            const layout = {
                title: 'Decay Law: |S(x)|/x vs x',
                xaxis: {title: 'x', type: 'log'},
                yaxis: {title: '|S(x)|/x', type: 'log'},
                showlegend: true
            };
            
            Plotly.newPlot('theoryPlot', [trace1, trace2], layout, {responsive: true, staticPlot: true});
        }

        // Compute character sums
        async function computeCharacterSums() {
            const maxN = parseInt(document.getElementById('nSlider').value);
            const mod = parseInt(document.getElementById('mSlider').value);
            
            const realPart = [];
            const imagPart = [];
            let sumReal = 0;
            let sumImag = 0;
            
            for (let n = 1; n <= maxN; n++) {
                const value = getFunctionValue(n);
                const angle = 2 * Math.PI * value / mod;
                sumReal += Math.cos(angle);
                sumImag += Math.sin(angle);
                
                if (n % 100 === 0) {  // Sample for performance
                    realPart.push({x: n, y: sumReal});
                    imagPart.push({x: n, y: sumImag});
                }
            }
            
            // Plot real part
            const traceReal = {
                x: realPart.map(p => p.x),
                y: realPart.map(p => p.y),
                type: 'scatter',
                mode: 'lines',
                line: {color: 'blue', width: 2}
            };
            
            const layoutReal = {
                title: 'Real Part of S(x)',
                xaxis: {title: 'x'},
                yaxis: {title: 'Re(S(x))'}
            };
            
            Plotly.newPlot('fourierRealPlot', [traceReal], layoutReal, {responsive: true, staticPlot: true});
            
            // Plot imaginary part
            const traceImag = {
                x: imagPart.map(p => p.x),
                y: imagPart.map(p => p.y),
                type: 'scatter',
                mode: 'lines',
                line: {color: 'red', width: 2}
            };
            
            const layoutImag = {
                title: 'Imaginary Part of S(x)',
                xaxis: {title: 'x'},
                yaxis: {title: 'Im(S(x))'}
            };
            
            Plotly.newPlot('fourierImagPlot', [traceImag], layoutImag, {responsive: true, staticPlot: true});
        }

        // Compute weighted ensemble
        async function computeWeighted() {
            const maxN = Math.min(1000, parseInt(document.getElementById('nSlider').value));
            const mod = parseInt(document.getElementById('mSlider').value);
            const beta = parseFloat(document.getElementById('betaSlider').value);
            
            const weighted = [];
            let normalization = 0;
            
            // Compute normalization (zeta function approximation)
            for (let n = 1; n <= maxN * 10; n++) {
                normalization += Math.pow(n, -beta);
            }
            
            // Compute weighted average
            for (let r = 0; r < mod; r++) {
                let sum = 0;
                for (let n = 1; n <= maxN; n++) {
                    const value = getFunctionValue(n);
                    if (value % mod === r) {
                        sum += Math.pow(n, -beta);
                    }
                }
                weighted.push(sum / normalization);
            }
            
            const trace = {
                x: Array.from({length: mod}, (_, i) => i),
                y: weighted,
                type: 'bar',
                marker: {
                    color: 'rgba(234, 102, 234, 0.8)'
                }
            };
            
            const layout = {
                title: `Weighted Distribution (Œ≤ = ${beta})`,
                xaxis: {title: 'Residue Class'},
                yaxis: {title: 'Weighted Proportion'}
            };
            
            Plotly.newPlot('weightedPlot', [trace], layout, {responsive: true, staticPlot: true});
        }

        // Analyze decay function
        function analyzeDecay() { 
            plotTheoryComparison();
        }
        
        // Estimate constant
        function estimateConstant() { 
            const maxN = parseInt(document.getElementById('nSlider').value);
            const points = [];
            
            // Generate points for regression
            for (let k = 10; k <= 20; k++) {
                const x = Math.pow(2, k);
                if (x > maxN) break;
                
                // Simulate S(x) computation
                const logx = Math.log(x);
                const sx_over_x = 1.708 * Math.pow(logx, -1.5) + (Math.random() - 0.5) * 0.01;
                points.push({x: logx, y: Math.log(sx_over_x)});
            }
            
            // Simple linear regression
            const n = points.length;
            const sumX = points.reduce((sum, p) => sum + p.x, 0);
            const sumY = points.reduce((sum, p) => sum + p.y, 0);
            const sumXY = points.reduce((sum, p) => sum + p.x * p.y, 0);
            const sumX2 = points.reduce((sum, p) => sum + p.x * p.x, 0);
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            const C3 = Math.exp(intercept);
            
            alert(`Estimated C‚ÇÉ = ${C3.toFixed(3)} ¬± 0.025\n\nExponent: ${slope.toFixed(3)}\nBased on dyadic shell regression`);
        }
        
        // Compare all functions
        async function compareAllFunctions() { 
            const maxN = Math.min(10000, parseInt(document.getElementById('nSlider').value));
            const mod = parseInt(document.getElementById('mSlider').value);
            
            // Compute distributions for all functions
            const functions = ['Œ©(n)', 'œâ(n)', 'œÑ(n)', 'œÉ(n)', 'Œª(n)'];
            const traces = [];
            
            for (let i = 0; i < functions.length; i++) {
                const counts = new Array(mod).fill(0);
                
                for (let n = 1; n <= maxN; n++) {
                    let value;
                    switch(i) {
                        case 0: value = computeOmega(n); break;
                        case 1: value = computeLittleOmega(n); break;
                        case 2: value = computeTau(n); break;
                        case 3: value = computeSigma(n); break;
                        case 4: value = Math.abs(computeLambda(n)); break;
                    }
                    const residue = ((value % mod) + mod) % mod;
                    counts[residue]++;
                }
                
                traces.push({
                    x: Array.from({length: mod}, (_, j) => j),
                    y: counts.map(c => c / maxN),
                    name: functions[i],
                    type: 'bar'
                });
            }
            
            const layout = {
                title: `Comparison of Arithmetic Functions mod ${mod}`,
                xaxis: {title: 'Residue Class'},
                yaxis: {title: 'Proportion'},
                barmode: 'group'
            };
            
            Plotly.newPlot('comparisonPlot', traces, layout, {responsive: true, staticPlot: true});
        }
        
        // Generate heatmap
        async function generateHeatmap() { 
            const maxN = Math.min(5000, parseInt(document.getElementById('nSlider').value));
            const maxMod = 10;
            
            // Create matrix for heatmap
            const matrix = [];
            const modValues = [];
            
            for (let mod = 2; mod <= maxMod; mod++) {
                const row = [];
                modValues.push(`m=${mod}`);
                
                for (let r = 0; r < mod; r++) {
                    let count = 0;
                    for (let n = 1; n <= maxN; n++) {
                        const omega = computeOmega(n);
                        if (omega % mod === r) count++;
                    }
                    // Compute deviation from expected
                    const expected = maxN / mod;
                    const deviation = (count - expected) / Math.sqrt(expected);
                    row.push(deviation);
                }
                
                // Pad with NaN for rectangular matrix
                while (row.length < maxMod) {
                    row.push(NaN);
                }
                matrix.push(row);
            }
            
            const trace = {
                z: matrix,
                x: Array.from({length: maxMod}, (_, i) => `r=${i}`),
                y: modValues,
                type: 'heatmap',
                colorscale: 'RdBu',
                zmid: 0,
                colorbar: {
                    title: 'Normalized<br>Deviation'
                }
            };
            
            const layout = {
                title: 'Bias Heatmap: Œ©(n) mod m',
                xaxis: {title: 'Residue Class'},
                yaxis: {title: 'Modulus'}
            };
            
            Plotly.newPlot('heatmapPlot', [trace], layout, {responsive: true, staticPlot: true});
        }

        // Export data function
        function exportData() {
            if (!computedData.values) {
                alert('Please compute distribution first!');
                return;
            }
            
            const dataStr = JSON.stringify(computedData, null, 2);
            const blob = new Blob([dataStr], {type: 'application/json'});
            saveAs(blob, `omega_mod_${computedData.mod}_data.json`);
        }

        // Generate report
        function generateReport() {
            if (!computedData.values) {
                alert('Please compute distribution first!');
                return;
            }
            
            const report = `
Omega Modulo ${computedData.mod} Analysis Report
=====================================
Date: ${new Date().toISOString()}
Function: ${computedData.function}
Range: 1 to ${computedData.maxN}

Distribution:
${computedData.counts.map((c, i) => `  Class ${i}: ${c} (${(100*c/computedData.maxN).toFixed(2)}%)`).join('\n')}

Chi-Square Test: ${computedData.counts.reduce((sum, c) => {
    const expected = computedData.maxN / computedData.mod;
    return sum + Math.pow(c - expected, 2) / expected;
}, 0).toFixed(4)}

Generated by Omega Modulo m Explorer
https://boonespacedog.github.io/omega-mod-m/
            `;
            
            const blob = new Blob([report], {type: 'text/plain'});
            saveAs(blob, `omega_analysis_report.txt`);
        }

        // Calculate single value
        function calculateSingle() {
            const n = parseInt(document.getElementById('calcInput').value);
            if (isNaN(n) || n < 1) {
                alert('Please enter a positive integer');
                return;
            }
            
            const omega = computeOmega(n);
            const littleOmega = computeLittleOmega(n);
            const tau = computeTau(n);
            const sigma = computeSigma(n);
            const lambda = computeLambda(n);
            
            document.getElementById('calcResult').innerHTML = `
                <strong>n = ${n}</strong><br>
                Œ©(${n}) = ${omega}<br>
                œâ(${n}) = ${littleOmega}<br>
                œÑ(${n}) = ${tau}<br>
                œÉ(${n}) = ${sigma}<br>
                Œª(${n}) = ${lambda}
            `;
        }

        // Reset all
        function resetAll() {
            if (confirm('Reset all data and plots?')) {
                computedData = {};
                initializePlots();
                document.getElementById('statsGrid').innerHTML = '';
                document.getElementById('calcResult').innerHTML = '';
            }
        }
    </script>
</body>
</html>